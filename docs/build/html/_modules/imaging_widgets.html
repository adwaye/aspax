

<!DOCTYPE html>
<html class="writer-html5" lang="python" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>imaging_widgets &mdash; aspax Annotator 0.0.14 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> aspax Annotator
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">aspax Annotator</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>imaging_widgets</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for imaging_widgets</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module containing the classes used for the image viewer on the right of aspax.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QGraphicsView</span><span class="p">,</span><span class="n">QGraphicsScene</span><span class="p">,</span><span class="n">QWidget</span><span class="p">,</span><span class="n">QToolBar</span><span class="p">,</span><span class="n">QVBoxLayout</span><span class="p">,</span><span class="n">QAction</span><span class="p">,</span> <span class="n">QButtonGroup</span><span class="p">,</span> \
    <span class="n">QActionGroup</span><span class="p">,</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">,</span> <span class="n">QCheckBox</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QFrame</span><span class="p">,</span>\
    <span class="n">QTabWidget</span><span class="p">,</span><span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">,</span> <span class="n">QDialogButtonBox</span><span class="p">,</span> <span class="n">QGridLayout</span><span class="p">,</span> <span class="n">QSpacerItem</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="p">,</span> <span class="n">QScrollArea</span>
<span class="kn">from</span> <span class="nn">annotation_profiles</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QColor</span><span class="p">,</span><span class="n">QPixmap</span><span class="p">,</span> <span class="n">QFont</span><span class="p">,</span> <span class="n">QImage</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">graphics_items</span> <span class="kn">import</span> <span class="n">PolylineItem</span><span class="p">,</span><span class="n">RectItem</span><span class="p">,</span> <span class="n">DEFAULT_HANDLE_SIZE</span><span class="p">,</span> <span class="n">DEFAULT_EDGE_WIDTH</span><span class="p">,</span> <span class="n">BaseRectItem</span>
<span class="kn">from</span> <span class="nn">data_models</span> <span class="kn">import</span> <span class="n">Polyline</span><span class="p">,</span> <span class="n">Rect</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">menu_widgets</span> <span class="kn">import</span> <span class="n">score_sliders</span>
<span class="c1"># from MenuWidgets import Slider</span>
<span class="kn">import</span> <span class="nn">pydicom</span>
<span class="kn">import</span> <span class="nn">scipy.io</span> <span class="k">as</span> <span class="nn">sio</span>
<span class="kn">from</span> <span class="nn">dicom_process</span> <span class="kn">import</span> <span class="n">extract_pixel_spacing</span>



<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">_NP</span>


<div class="viewcode-block" id="MyView"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyView">[docs]</a><span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">QGraphicsView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;QGraphicsView to display the image being annotated. It defines the mouse behaviour within itself.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        my_view = MyView()</span>
<span class="sd">        my_scene = QGraphicsScene()</span>
<span class="sd">        my_view.setScene()</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="MyView.mousePressEvent"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyView.mousePressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Defines the mouse press events.</span>

<span class="sd">        :param event: mouse press event</span>
<span class="sd">        :type event: mousePressEvent</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">:</span>  <span class="c1"># If the click event on the button is right-click</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__prevMousePos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>  <span class="c1"># Set the previous mouse position as the previous mouse position</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">MyView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

    <span class="c1"># Function that controls mouse movements -</span>
<div class="viewcode-block" id="MyView.mouseMoveEvent"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyView.mouseMoveEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Defines the mouse move events. MOveing the mouse while pressing the right button pans the view</span>

<span class="sd">        :param event: mouse move event</span>
<span class="sd">        :type event: mouseMoveEvent</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">buttons</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prevMousePos</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>  <span class="c1"># Calculates the movements in offset variable</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__prevMousePos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>  <span class="c1"># Saves current mouse position as new previous mouse position</span>
            <span class="c1"># Below translates difference in mouse positions to differences in scroll bars, implementing movement</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="n">offset</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizontalScrollBar</span><span class="p">()</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizontalScrollBar</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="n">offset</span><span class="o">.</span><span class="n">x</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Otherwise, normal mouse behaviour with left click - inherited by super</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">MyView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mouseMoveEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MyScene"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyScene">[docs]</a><span class="k">class</span> <span class="nc">MyScene</span><span class="p">(</span><span class="n">QGraphicsScene</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :ivar polyline_annotate_item: controllable item for polyline annotation, gets added when draw_poly_flag is set to True</span>
<span class="sd">                                  used to delineate bones etc</span>
<span class="sd">    :vartype polyline_annotate_item: graphics_item.PolyLineItem</span>
<span class="sd">    :ivar rect_annotate_item: controllable item for polyline annotation, gets added when draw_poly_flag is set to True</span>
<span class="sd">                              used to annotate joints with patches</span>
<span class="sd">    :vartype rect_annotate_item: graphics_item.RectItem</span>
<span class="sd">    :ivar pixmap: rendered image being displayed</span>
<span class="sd">    :vartype pixmap: bool</span>
<span class="sd">    :ivar start: dummy variables used to draw the controllable items shape (1,2)</span>
<span class="sd">    :vartype start: array-like</span>
<span class="sd">    :ivar end: dummy variables used to draw the controllable items shape (1,2)</span>
<span class="sd">    :vartype end: array-like</span>
<span class="sd">    :ivar annotation_length: keeps track of the  number of points in the polyline_annotate_item</span>
<span class="sd">    :vartype annotation_length: int</span>
<span class="sd">    :ivar list_of_undone_points: unused</span>
<span class="sd">    :vartype list_of_undone_points: None</span>
<span class="sd">    :ivar draw_poly_flag: if True, clicking inside the scnee  will draw a PolyLineItem, cannot be True</span>
<span class="sd">                          while draw_recr_flag is True</span>
<span class="sd">    :vartype draw_poly_flag: bool</span>
<span class="sd">    :ivar draw_rect_flag: if True, pressing the mouse press move and release will draw a rectItem, cannot be True while </span>
<span class="sd">                          draw_poly_flag is True</span>
<span class="sd">    :vartype draw_rect_flag: bool</span>
<span class="sd">    :ivar pressed: switches to True when the mouse is pressed</span>
<span class="sd">    :vartype pressed: bool</span>
<span class="sd">    :ivar edge_width: width of polyline and rect item edges</span>
<span class="sd">    :vartype edge_width: float</span>
<span class="sd">    :ivar handle_size: size of the draggable ControllableItem handles</span>
<span class="sd">    :vartype handle_size: float</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">actual_distance_between_points</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyScene</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">pixmap</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">pixmap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addPixmap</span><span class="p">(</span><span class="n">pixmap</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span>     <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span>                  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span>                    <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_length</span>      <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_undone_points</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_poly_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_rect_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_width</span> <span class="o">=</span> <span class="n">DEFAULT_EDGE_WIDTH</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_size</span> <span class="o">=</span> <span class="n">DEFAULT_HANDLE_SIZE</span>

<div class="viewcode-block" id="MyScene.display_image"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyScene.display_image">[docs]</a>    <span class="k">def</span> <span class="nf">display_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds the image img as a pixmap item</span>

<span class="sd">        :param img: Image to be displayed</span>
<span class="sd">        :type img: QPixmap()</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            my_view = MyView()</span>
<span class="sd">            my_scene = QGraphicsScene()</span>
<span class="sd">            my_view.setScene()</span>
<span class="sd">            file_path = &#39;img/image.png&#39;</span>
<span class="sd">            pixmap = QPixMap()</span>
<span class="sd">            pixmap.load(file_path)</span>
<span class="sd">            my_scene.display_image(pixmap)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addPixmap</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>


<div class="viewcode-block" id="MyScene.add_polyline"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyScene.add_polyline">[docs]</a>    <span class="k">def</span> <span class="nf">add_polyline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">control_points</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method that adds a polyline to the scene. only called when there are not polylines. Clicking when</span>
<span class="sd">        draw_poly_flag is True and when annotation_length=0 adds one control_point where the mouse click occurs</span>

<span class="sd">        :param control_points: coordinate shape (N,2) where PolyLine is added</span>
<span class="sd">        :type control_points: array-like</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">polyline_annotate</span> <span class="o">=</span> <span class="n">Polyline</span><span class="p">(</span><span class="n">control_points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span> <span class="o">=</span> <span class="n">PolylineItem</span><span class="p">(</span><span class="n">polyline_annotate</span><span class="p">,</span> <span class="n">edge_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_width</span><span class="p">,</span>
                                                   <span class="n">handle_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="o">.</span><span class="n">edge_color</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="s2">&quot;#FF511C&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="p">)</span>
        <span class="c1">#print(len(control_points))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_length</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">control_points</span><span class="p">)</span></div>

<div class="viewcode-block" id="MyScene.add_rectItem"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyScene.add_rectItem">[docs]</a>    <span class="k">def</span> <span class="nf">add_rectItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a rectItem with top corner coordinate x,y and width w, h</span>

<span class="sd">        :param x: x coordinate of top corner</span>
<span class="sd">        :type x: float</span>
<span class="sd">        :param y: y coordinate of top corner</span>
<span class="sd">        :type y: float</span>
<span class="sd">        :param w: width</span>
<span class="sd">        :type w: float</span>
<span class="sd">        :param h: width</span>
<span class="sd">        :type h: float</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span> <span class="o">=</span> <span class="n">RectItem</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">h</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">.</span><span class="n">rotate_handle</span><span class="p">)</span></div>

<div class="viewcode-block" id="MyScene.add_rectItemBase"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyScene.add_rectItemBase">[docs]</a>    <span class="k">def</span> <span class="nf">add_rectItemBase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a BaseRectItem (no rotation allowed) with top corner coordinate x,y and width w, h</span>

<span class="sd">        :param x: x coordinate of top corner</span>
<span class="sd">        :type x: float</span>
<span class="sd">        :param y: y coordinate of top corner</span>
<span class="sd">        :type y: float</span>
<span class="sd">        :param w: width</span>
<span class="sd">        :type w: float</span>
<span class="sd">        :param h: width</span>
<span class="sd">        :type h: float</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span> <span class="o">=</span> <span class="n">BaseRectItem</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="p">)</span></div>
        <span class="c1"># self.addItem(self.rect_annotate_item.rotate_handle)</span>


<div class="viewcode-block" id="MyScene.mousePressEvent"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyScene.mousePressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the behaviour of a mousePressEvent. If draw_poly_flag is True, a PolyLineItem is added if not present already.</span>
<span class="sd">        If a polyline is present while draw_poly_flag is true, then the control_points are appended with new control_points</span>
<span class="sd">        having the same coordinates as the mouse press. Pressing control while clicking does not add any new</span>
<span class="sd">        GraphicsItem but allows the user to drag GraphicItem handles. If draw_rect_flag is True, then the scene waits for a drag release event to draw a recItem</span>

<span class="sd">        :param event:</span>
<span class="sd">        :type event:</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">scenePos</span><span class="p">())</span>


        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
                <span class="n">coord</span> <span class="o">=</span> <span class="n">_NP</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">mapFromScene</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()))</span>  <span class="c1"># Store the click coordinates in a list of lists</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">coord</span>
                <span class="c1"># print(coord)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_poly_flag</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">:</span> <span class="c1"># If the measure distance</span>
                    <span class="c1"># functionality is active</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Draw and store first coordinate</span>
                        <span class="c1"># polyline_annotate = Polyline(coord)</span>
                        <span class="c1"># self.polyline_annotate_item = PolylineItem(polyline_annotate,edge_width=self.edge_width,handle_size=self.handle_size)</span>
                        <span class="c1"># self.polyline_annotate_item.edge_color = QColor(&quot;#FF511C&quot;)</span>
                        <span class="c1">#</span>
                        <span class="c1">#</span>
                        <span class="c1"># self.addItem(self.polyline_annotate_item)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_polyline</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addControlPoints</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_length</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">:</span>
                    <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>\
                            <span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">width</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">height</span>
                    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x1</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y1</span><span class="o">+</span><span class="n">h</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">x1</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">x2</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">y1</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">y2</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pressed</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">coord</span>
                            <span class="nb">print</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">MyScene</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="MyScene.mouseMoveEvent"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyScene.mouseMoveEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handles mouse move events. Mostly hanldes the dragging of the rectItem</span>

<span class="sd">        :param event:</span>
<span class="sd">        :type event:</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">scenePos</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span><span class="p">:</span>

                <span class="n">coord</span> <span class="o">=</span> <span class="n">_NP</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">mapFromScene</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">coord</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="n">_NP</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">mapFromScene</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()))</span>


                    <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">x</span>
                    <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">coord</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_shiftControlPts</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
                    <span class="c1"># print(&#39;control points= &#39;)</span>
                    <span class="c1"># print(self.rect_annotate_item.model.control_points)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyScene</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mouseMoveEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>
                <span class="c1"># rect_model = Rect(x=self.start[0],y=self.start[0],width=width,height=height)</span>
                <span class="c1"># self.rect_annotate_item = RectItem(x=self.start[0],y=self.start[1],width=width,height=height)</span>
                <span class="c1"># self.addItem(self.rect_annotate_item)</span>

<div class="viewcode-block" id="MyScene.mouseReleaseEvent"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyScene.mouseReleaseEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handles a mouse release event. See Mouse press event for more information on functionality</span>

<span class="sd">        :param event:</span>
<span class="sd">        :type event:</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">scenePos</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span><span class="p">:</span>
                <span class="n">width</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">rect_model</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_rect_flag</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_rectItem</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">w</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
                    <span class="c1"># self.rect_annotate_item = RectItem(x=self.start[0],y=self.start[1],width=width,height=height)</span>
                    <span class="c1"># self.addItem(self.rect_annotate_item)</span>
                    <span class="c1"># self.addItem(self.rect_annotate_item.rotate_handle)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyScene</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mouseMoveEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>





<div class="viewcode-block" id="MyScene.clear_poly"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyScene.clear_poly">[docs]</a>    <span class="k">def</span> <span class="nf">clear_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes any controllable item still present in the scene</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="o">=</span><span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotation_length</span>     <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="p">)</span> <span class="ow">is</span> <span class="n">RectItem</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">.</span><span class="n">rotate_handle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">=</span><span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span>     <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end</span>       <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MyScene.undo"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MyScene.undo">[docs]</a>    <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_length</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="p">)</span>


            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">control_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">control_points</span>
            <span class="n">polyline_annotate</span> <span class="o">=</span> <span class="n">Polyline</span><span class="p">(</span><span class="n">control_points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span> <span class="o">=</span> <span class="n">PolylineItem</span><span class="p">(</span><span class="n">polyline_annotate</span><span class="p">,</span><span class="n">edge_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_width</span><span class="p">,</span>
                                                   <span class="n">handle_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="o">.</span><span class="n">edge_color</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="s2">&quot;#FF511C&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">annotation_length</span><span class="o">-=</span><span class="mi">1</span></div></div>

<span class="c1"># Class to handle the x-ray image - including zooming, contrasts, annotating etc.</span>
<div class="viewcode-block" id="ImageHandler"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler">[docs]</a><span class="k">class</span> <span class="nc">ImageHandler</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Widget that encompasses all of the image manipulation options as well as the image viewer.</span>

<span class="sd">    :param icon_library: Dictionary of key value pairs where the keys are strings in the set</span>
<span class="sd">                        [&quot;Draw Polyline&quot;,&quot;Draw Rectangle&quot;,&quot;Zoom Out&quot;,&quot;Zoom In&quot;,&quot;Undo&quot;,&quot;Redo&quot;,&quot;Clear Label&quot;] and the</span>
<span class="sd">                        values are image files that are converted to icons. These icons are used to initialise the</span>
<span class="sd">                        toolbar buttons. It is important that the above keys are present otherwise one gets an error</span>
<span class="sd">                        when the ImagingToolbar is initialised.</span>
<span class="sd">    :type icon_library: dict</span>
<span class="sd">    :param output_loc: location where one wishes to save the annotations. Note that if this folder is non-empty,</span>
<span class="sd">                       then it is desirable for this to follow the aspax folder structure.</span>
<span class="sd">    :type output_loc: str</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">icon_library</span><span class="p">,</span><span class="n">output_loc</span><span class="p">):</span>



        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixel_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_loc</span> <span class="o">=</span> <span class="n">output_loc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_loc</span><span class="p">,</span><span class="s1">&#39;temp_file.png&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaling_factor</span> <span class="o">=</span> <span class="mf">1.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_empty</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_view</span> <span class="o">=</span> <span class="n">MyView</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_view</span><span class="o">.</span><span class="n">setMouseTracking</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_view</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_view</span><span class="o">.</span><span class="n">centerOn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_view</span><span class="o">.</span><span class="n">setHorizontalScrollBarPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ScrollBarAsNeeded</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_view</span><span class="o">.</span><span class="n">setVerticalScrollBarPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ScrollBarAsNeeded</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span> <span class="o">=</span> <span class="n">MyScene</span><span class="p">()</span>
        <span class="c1"># self.load_image(&#39;CPSA0019h2011.png&#39;)</span>
        <span class="c1"># self.load_image(&#39;johncena.jpg&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_view</span><span class="o">.</span><span class="n">setScene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_quality_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="n">ImagingToolbar</span><span class="p">(</span><span class="n">icon_library</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span> <span class="o">=</span> <span class="n">QTabWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_options</span> <span class="o">=</span> <span class="n">AnnotationModelOptions</span><span class="p">()</span>

        <span class="c1"># horizontal_dock = QHBoxLayout()</span>
        <span class="c1"># horizontal_dock.addWidget(self.annotation_options,50)</span>
        <span class="c1">#</span>
        <span class="c1"># horizontal_widget = QWidget()</span>
        <span class="c1"># # horizontal_widget.setMinimumSize(1600,200)</span>
        <span class="c1"># # horizontal_widget.setMaximumSize(1600,200)</span>
        <span class="c1">#</span>
        <span class="c1"># horizontal_widget.setLayout(horizontal_dock)</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1"># self.tabs.addTab(horizontal_widget,&quot;View Annotations&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_options</span><span class="p">,</span><span class="s2">&quot;View Annotations&quot;</span><span class="p">)</span>
        <span class="c1"># self.tabs.setMinimumSize(1600,220)</span>
        <span class="c1"># self.tabs.setMaximumSize(1600,220)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_select_options</span> <span class="o">=</span> <span class="n">AnnotationSelectOptions</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Polylines&#39;</span><span class="p">)</span>
        <span class="n">scrollbar1</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">(</span><span class="n">widgetResizable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">scrollbar1</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poly_select_options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">scrollbar1</span><span class="p">,</span><span class="s2">&quot;Polylines&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect_select_options</span> <span class="o">=</span> <span class="n">AnnotationSelectOptions</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Rect Items&#39;</span><span class="p">)</span>
        <span class="n">scrollbar2</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">(</span><span class="n">widgetResizable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">scrollbar2</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rect_select_options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">scrollbar2</span><span class="p">,</span><span class="s2">&quot;Rectangles&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_windowing</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_view</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icons</span> <span class="o">=</span> <span class="n">icon_library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activate_toolbar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom_tracker</span>  <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom_out_scaling_factor</span> <span class="o">=</span> <span class="mf">1.0</span>


        <span class="c1">#replace with a connect toolbar</span>
        <span class="c1"># Toolbar settings - guidance on https://www.learnpyqt.com/courses/start/actions-toolbars-menus/</span>
<div class="viewcode-block" id="ImageHandler.activate_toolbar"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.activate_toolbar">[docs]</a>    <span class="k">def</span> <span class="nf">activate_toolbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connects buttons in the ImagingToolbar instance to various methods.</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Zoom Out&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom_out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Zoom In&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom_in</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Undo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">undo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Clear Label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">clear_poly</span><span class="p">)</span>

        <span class="n">draw_group</span> <span class="o">=</span> <span class="n">QActionGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">draw_group</span><span class="o">.</span><span class="n">setExclusive</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Draw Polyline&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Draw Rectangle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">draw_group</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Draw Rectangle&#39;</span><span class="p">])</span>
        <span class="n">draw_group</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Draw Polyline&#39;</span><span class="p">])</span>

        <span class="n">like_dislike_group</span> <span class="o">=</span> <span class="n">QActionGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">like_dislike_group</span><span class="o">.</span><span class="n">setExclusive</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Bad Image Quality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Good Image Quality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">like_dislike_group</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Bad Image Quality&#39;</span><span class="p">])</span>
        <span class="n">like_dislike_group</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Good Image Quality&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Draw Polyline&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_action_states</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Draw Rectangle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_action_states</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_options</span><span class="o">.</span><span class="n">score_sliders</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1">#val.sliderMoved[int].connect(self.save_slider_value())</span>
            <span class="n">val</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_annotation_dimensions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Annotate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Annotate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger_annotation_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_select_options</span><span class="o">.</span><span class="n">overwrite_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overwrite_annotation_poly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect_select_options</span><span class="o">.</span><span class="n">overwrite_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overwrite_annotation_rect</span><span class="p">)</span></div>
        <span class="c1">#.triggered.connect(self.image_scene.clear_poly)</span>
        <span class="c1"># self.toolbar.buttons[&#39;Draw Rect&#39;].triggered.connect(self.image_scene.clear_poly)</span>

<div class="viewcode-block" id="ImageHandler.trigger_annotation_mode"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.trigger_annotation_mode">[docs]</a>    <span class="k">def</span> <span class="nf">trigger_annotation_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method that allows one to set up an annotation exercise where the annotator is asked to annotate set bones</span>
<span class="sd">        one after the other. Currently not being used. It initialises a new panel where one can choose to start an</span>
<span class="sd">        annotation exercise that has inrtcustions on which joints to annotated. This method needs more work as it</span>
<span class="sd">        crashes a lot.</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Annotate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span> <span class="o">=</span> <span class="n">JointAnnotatorPanel</span><span class="p">()</span>
            <span class="c1"># self.joint_annotator_panel.setMaximumSize(800,200)</span>
            <span class="c1"># self.joint_annotator_panel.setMinimumSize(800,200)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">output_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_loc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">load_profilers</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="p">,</span><span class="s1">&#39;Joint Annotator&#39;</span><span class="p">)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">start_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_annotation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">reset_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_annotation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

            <span class="c1">#print(f&#39;there are {count} tabs&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">removeTab</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span></div>



<div class="viewcode-block" id="ImageHandler.load_image"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.load_image">[docs]</a>    <span class="k">def</span> <span class="nf">load_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads the file_name and passes it to a QPixmap object which is then used</span>
<span class="sd">        sets self.pixmap. calls self.display_image(self.pixmap) which displays the image in the scene</span>

<span class="sd">        :param file_name: full path of file containing the image</span>
<span class="sd">                          if image is a regular image file, the Pixmap is created by reading it</span>
<span class="sd">                          if image is a dicom, the pixel_array property of the dicom gets loaded</span>
<span class="sd">                          by passing it to the correct image format</span>
<span class="sd">                          if image is a mat file, creats a matfiledialog which allows the user to select</span>
<span class="sd">                          the desired array that has the image data</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;jpg&#39;</span><span class="p">,</span><span class="s1">&#39;JPEG&#39;</span><span class="p">,</span><span class="s1">&#39;JPG&#39;</span><span class="p">,</span><span class="s1">&#39;PNG&#39;</span><span class="p">]</span>
        <span class="n">mat_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mat&#39;</span><span class="p">]</span>
        <span class="n">dicom_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dicom&#39;</span><span class="p">,</span><span class="s1">&#39;dcm&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span> <span class="o">=</span> <span class="n">file_name</span>
        <span class="n">file_ext</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">is_image</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">image_extensions</span> <span class="k">if</span> <span class="p">(</span><span class="n">ele</span> <span class="ow">in</span> <span class="n">file_ext</span><span class="p">)]</span>
        <span class="n">is_mat</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">mat_extensions</span> <span class="k">if</span> <span class="p">(</span><span class="n">ele</span> <span class="ow">in</span> <span class="n">file_ext</span><span class="p">)]</span>
        <span class="n">is_dicom</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">dicom_extensions</span> <span class="k">if</span> <span class="p">(</span><span class="n">ele</span> <span class="ow">in</span> <span class="n">file_ext</span><span class="p">)]</span>

        <span class="n">file_loc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_loc</span><span class="p">,</span><span class="s1">&#39;temp_file.png&#39;</span><span class="p">)</span>
        <span class="c1"># temp_name = &#39;./temp_file.png&#39;</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">is_image</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span>          <span class="o">=</span> <span class="n">QPixmap</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">bool</span><span class="p">(</span><span class="n">is_dicom</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dicom_file</span>  <span class="o">=</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="n">pixel_width</span> <span class="o">=</span> <span class="n">extract_pixel_spacing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dicom_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pixel_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pixel_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pixel_width</span><span class="p">)</span>

            <span class="c1"># try:</span>
            <span class="c1">#     cvImg = self.dicom_file.pixel_array.astype(np.float16)</span>
            <span class="c1">#     self.raw_data = cvImg</span>
            <span class="c1">#     cvImg = self.normalise(cvImg)</span>
            <span class="c1">#     # cvImg = ((cvImg - np.min(cvImg)) / np.max(cvImg)) * 255</span>
            <span class="c1">#     cvImgX = np.array([cvImg,cvImg,cvImg]).astype(np.uint32)</span>
            <span class="c1">#     cvImgX = np.transpose(cvImgX,[1,2,0])</span>
            <span class="c1">#     height,width,depth = cvImgX.shape</span>
            <span class="c1">#     a = cvImgX.copy()</span>
            <span class="c1">#     b = (255 &lt;&lt; 24 | a[:,:,0] &lt;&lt; 16 | a[:,:,1] &lt;&lt; 8 | a[:,:,2]).flatten()</span>
            <span class="c1">#     bytesPerLine = 3 * width</span>
            <span class="c1">#     qImg = QImage(b, width, height, QImage.Format_RGBA8888)</span>
            <span class="c1">#     self.pixmap = QPixmap(qImg)</span>
            <span class="c1"># except np.core._exceptions._ArrayMemoryError:</span>
            <span class="c1">#     print(&quot;not enough memory&quot;)</span>

            <span class="n">cvImg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dicom_file</span><span class="o">.</span><span class="n">pixel_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
            <span class="n">cvImg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalise</span><span class="p">(</span><span class="n">cvImg</span><span class="p">)</span>
            <span class="n">cvImg</span> <span class="o">=</span> <span class="n">cvImg</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span><span class="p">,</span> <span class="n">cvImg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span><span class="p">)</span>




        <span class="k">elif</span> <span class="nb">bool</span><span class="p">(</span><span class="n">is_mat</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matfile</span> <span class="o">=</span> <span class="n">sio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matfile_select</span> <span class="o">=</span> <span class="n">MatfileOptions</span><span class="p">()</span><span class="c1">#creates a dialog that allows one to select which element from the</span>
            <span class="c1"># matfile to load</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matfile_select</span><span class="o">.</span><span class="n">load_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matfile_select</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matfile_select</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_array_from_matfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matfile_select</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matfile_select</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>




        <span class="bp">self</span><span class="o">.</span><span class="n">get_image_dimensions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span><span class="p">)</span></div>
        <span class="c1"># self.load_windowing()</span>

<div class="viewcode-block" id="ImageHandler.invert_image"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.invert_image">[docs]</a>    <span class="k">def</span> <span class="nf">invert_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method to invert the color scale of the displayed image.</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cvImg</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span><span class="p">,</span> <span class="n">cvImg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">cvImg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">display_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span><span class="p">)</span></div>



<div class="viewcode-block" id="ImageHandler.load_windowing"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.load_windowing">[docs]</a>    <span class="k">def</span> <span class="nf">load_windowing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds the slider that allows one to perform image windowing in a different tab within the image options tabs.</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image_processor</span> <span class="o">=</span> <span class="n">Window_Sliders</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_processor</span><span class="p">,</span><span class="s2">&quot;Manipulate Image&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_processor</span><span class="o">.</span><span class="n">window_slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_processor</span><span class="o">.</span><span class="n">level_slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_processor</span><span class="o">.</span><span class="n">invert_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invert_image</span><span class="p">)</span></div>





<div class="viewcode-block" id="ImageHandler.window_image"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.window_image">[docs]</a>    <span class="k">def</span> <span class="nf">window_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Uses the slider values to change the image windowing. See https://radiopaedia.org/articles/windowing-ct?lang=gb</span>
<span class="sd">        for more info on this process.</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">window</span><span class="p">,</span><span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_processor</span><span class="o">.</span><span class="n">get_window_levels</span><span class="p">()</span>
        <span class="n">cvImg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
        <span class="n">upper_bound</span>  <span class="o">=</span> <span class="n">level</span><span class="o">+</span><span class="n">window</span>
        <span class="n">lower_bound</span>  <span class="o">=</span> <span class="n">level</span><span class="o">-</span><span class="n">window</span>
        <span class="n">cvImg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cvImg</span><span class="o">&gt;</span><span class="n">upper_bound</span><span class="p">)]</span> <span class="o">=</span> <span class="n">upper_bound</span>
        <span class="n">cvImg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cvImg</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">)]</span> <span class="o">=</span> <span class="n">lower_bound</span>
        <span class="c1"># try:</span>
        <span class="c1">#     cvImg = self.normalise(cvImg)</span>
        <span class="c1">#     # cvImg = ((cvImg - np.min(cvImg)) / np.max(cvImg)) * 255</span>
        <span class="c1">#     cvImgX = np.array([cvImg, cvImg, cvImg]).astype(np.uint32)</span>
        <span class="c1">#     cvImgX = np.transpose(cvImgX, [1, 2, 0])</span>
        <span class="c1">#     height, width, depth = cvImgX.shape</span>
        <span class="c1">#     a = cvImgX.copy()</span>
        <span class="c1">#     b = (255 &lt;&lt; 24 | a[:, :, 0] &lt;&lt; 16 | a[:, :, 1] &lt;&lt; 8 | a[:, :, 2]).flatten()</span>
        <span class="c1">#     bytesPerLine = 3 * width</span>
        <span class="c1">#     qImg = QImage(b, width, height, QImage.Format_RGBA8888)</span>
        <span class="c1">#     self.pixmap = QPixmap(qImg)</span>
        <span class="c1"># except np.core._exceptions._ArrayMemoryError:</span>
        <span class="c1">#     print(&quot;not enough memory&quot;)</span>

        <span class="n">cvImg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalise</span><span class="p">(</span><span class="n">cvImg</span><span class="p">)</span>
        <span class="n">cvImg</span> <span class="o">=</span> <span class="n">cvImg</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span><span class="p">,</span> <span class="n">cvImg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">display_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImageHandler.normalise"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.normalise">[docs]</a>    <span class="k">def</span> <span class="nf">normalise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Limits the image pixel intensity to 0-255</span>

<span class="sd">        :param image: image to be normalised</span>
<span class="sd">        :type image: np.array</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="p">((</span><span class="n">image</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image</span><span class="p">))</span> <span class="o">*</span> <span class="mi">255</span>
        <span class="k">return</span> <span class="n">image</span></div>


<div class="viewcode-block" id="ImageHandler.equalise"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.equalise">[docs]</a>    <span class="k">def</span> <span class="nf">equalise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs histogram equalisation on the fed image. Method adapted from from http://www.janeriksolem.net/histogram-equalization-with-python-and.html</span>

<span class="sd">        :param image: image to be normalised</span>
<span class="sd">        :type image: np.array</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>

        <span class="c1"># get image histogram</span>
        <span class="n">number_bins</span> <span class="o">=</span><span class="mi">256</span>
        <span class="n">image_histogram</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">number_bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cdf</span> <span class="o">=</span> <span class="n">image_histogram</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>  <span class="c1"># cumulative distribution function</span>
        <span class="n">cdf</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">cdf</span> <span class="o">/</span> <span class="n">cdf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># normalize</span>

        <span class="c1"># use linear interpolation of cdf to find new pixel values</span>
        <span class="n">image_equalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">cdf</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image_equalized</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span></div>


<div class="viewcode-block" id="ImageHandler.load_array_from_matfile"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.load_array_from_matfile">[docs]</a>    <span class="k">def</span> <span class="nf">load_array_from_matfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;connects to self.matfile_select.box.accepted, creates self.pixmap from the array corresponding to the key</span>
<span class="sd">        appearinng in the dropdown in matfile_select</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matfile_select</span><span class="o">.</span><span class="n">combo</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matfile</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">img</span>
        <span class="n">scaled_img</span> <span class="o">=</span> <span class="p">((</span><span class="n">img</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">img</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">img</span><span class="p">))</span><span class="o">*</span><span class="mi">255</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span><span class="p">,</span><span class="n">scaled_img</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span><span class="p">)</span></div>
        <span class="c1"># w = img.shape[1]</span>
        <span class="c1"># h = img.shape[0]</span>
        <span class="c1"># img2 = np.require(img,np.uint8,&#39;C&#39;)</span>
        <span class="c1"># image = QImage(img2,w,h,QImage.Format_RGB32)</span>
        <span class="c1"># self.pixmap = QPixmap.fromImage(img)</span>
        <span class="c1">#print(&quot;pixmap created&quot;)</span>

<div class="viewcode-block" id="ImageHandler.display_image"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.display_image">[docs]</a>    <span class="k">def</span> <span class="nf">display_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;wrapper for MyScene.display_image</span>

<span class="sd">        :param img: Image to be displayed</span>
<span class="sd">        :type img: QPixmap()</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># w = img.size[0]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">display_image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="c1"># w = 1000</span>
        <span class="c1"># h = 1000</span>
        <span class="c1"># self.image_view.fitInView(QRectF(0, 0, w, h), Qt.KeepAspectRatio)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="ImageHandler.update_annotation_dimensions"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.update_annotation_dimensions">[docs]</a>    <span class="k">def</span> <span class="nf">update_annotation_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Uses values from self.annotation_options widget sliders to update the size of the graphics items dots and</span>
<span class="sd">        lines.</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># size_dict = self.annotation_options.get_slider_value()</span>

        <span class="c1"># self.image_scene.handle_size = size_dict[&#39;Dot Size&#39;]</span>
        <span class="c1"># self.image_scene.edge_width  = size_dict[&#39;Line Width&#39;]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">handle_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_options</span><span class="o">.</span><span class="n">score_sliders</span><span class="p">[</span><span class="s1">&#39;Dot Size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">edge_width</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_options</span><span class="o">.</span><span class="n">score_sliders</span><span class="p">[</span><span class="s1">&#39;Line Width&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="c1"># self.image_scene.removeItem(self.image_scene.polyline_annotate_item)</span>
        <span class="c1"># qt5G.DEFAULT_HANDLE_SIZE = scala*maxSize</span>
        <span class="c1"># self.pLineItem = Pol	ylineItem(self.pLine,handle_size=100)</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">polyline_annotate_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="o">.</span><span class="n">prepareGeometryChange</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="o">.</span><span class="n">handle_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_options</span><span class="o">.</span><span class="n">score_sliders</span><span class="p">[</span><span class="s1">&#39;Dot Size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="o">.</span><span class="n">edge_width</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_options</span><span class="o">.</span><span class="n">score_sliders</span><span class="p">[</span><span class="s1">&#39;Line Width&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="c1"># self.image_scene.polyline_annotate_item.update()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="ImageHandler.get_image_dimensions"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.get_image_dimensions">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
        <span class="c1"># ImageHandler.image_width_pixels = ImageHandler.image.width()</span>
        <span class="c1"># ImageHandler.image_height_pixels = ImageHandler.image.height()</span>
        <span class="c1"># ImageHandler.image_width_mm = ImageHandler.image.widthMM()</span>
        <span class="c1"># ImageHandler.image_height_mm = ImageHandler.image.heightMM()</span>

<div class="viewcode-block" id="ImageHandler.get_image"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.get_image">[docs]</a>    <span class="k">def</span> <span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span></div>

<div class="viewcode-block" id="ImageHandler.get_image_scene"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.get_image_scene">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span></div>

<div class="viewcode-block" id="ImageHandler.toggle_action_states"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.toggle_action_states">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_action_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the different states of the various self.image_scene flags by checking the state of the toolbar</span>
<span class="sd">        pushbuttons. The flags are</span>
<span class="sd">        * draw_rect_flag : if True, then clicking and dragging creates a rectItem, cannot be true while</span>
<span class="sd">        draw_rect_flag is true</span>
<span class="sd">        * draw_rect_flag : if True, then clicking adds contro pouints to a PolylineItem, cannot be true while</span>
<span class="sd">        draw_rect_flag is true</span>
<span class="sd">        * image_quality_flag: if 0, means the quality is bad, and if 1, means the image quality is good. This value</span>
<span class="sd">                             is stored in the study metatable.</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if self.toolbar.buttons[&#39;Draw Rectangle&#39;].isChecked():</span>
        <span class="c1">#     self.toolbar.buttons[&#39;Draw Polyline&#39;].setChecked(0)</span>
        <span class="c1">#</span>
        <span class="c1"># if self.toolbar.buttons[&#39;Draw Polyline&#39;].isChecked():</span>
        <span class="c1">#     self.toolbar.buttons[&#39;Draw Rectangle&#39;].setChecked(0)</span>
        <span class="c1">#</span>
        <span class="c1"># if self.toolbar.buttons[&#39;Good Image Quality&#39;].isChecked():</span>
        <span class="c1">#     self.toolbar.buttons[&#39;Bad Image Quality&#39;].setChecked(0)</span>
        <span class="c1">#</span>
        <span class="c1"># if self.toolbar.buttons[&#39;Bad Image Quality&#39;].isChecked():</span>
        <span class="c1">#     self.toolbar.buttons[&#39;Good Image Quality&#39;].setChecked(0)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">draw_rect_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Draw Rectangle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">draw_poly_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Draw Polyline&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_quality_flag</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s1">&#39;Good Image Quality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span></div>

    <span class="c1"># Function to zoom in</span>
<div class="viewcode-block" id="ImageHandler.zoom_in"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.zoom_in">[docs]</a>    <span class="k">def</span> <span class="nf">zoom_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_tracker</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoom_in_scaling_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling_factor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_view</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom_in_scaling_factor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_in_scaling_factor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoom_tracker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_tracker</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_in_scaling_factor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_view</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="ImageHandler.zoom_out"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.zoom_out">[docs]</a>    <span class="k">def</span> <span class="nf">zoom_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_tracker</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoom_out_scaling_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling_factor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_view</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom_out_scaling_factor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_out_scaling_factor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoom_tracker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_tracker</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_out_scaling_factor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_view</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="ImageHandler.start_annotation"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.start_annotation">[docs]</a>    <span class="k">def</span> <span class="nf">start_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method used by the annotator_panel which is initialised by self.trigger_annotation_mode to start the </span>
<span class="sd">        annotation exercise.</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">next_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_annotation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">next_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_annotation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">joint_name_qline</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Click on Next to start&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImageHandler.reset_annotation"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.reset_annotation">[docs]</a>    <span class="k">def</span> <span class="nf">reset_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method used by the annotator_panel which is initialised by self.trigger_annotation_mode to start the</span>
<span class="sd">        annotation exercise.</span>
<span class="sd">        </span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_annotation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_annotation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">joint_name_qline</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">profiler_dicts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">profile_dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()]</span> <span class="o">=</span> <span class="n">HandJointAnnotationProfiler</span><span class="p">()</span></div>


<div class="viewcode-block" id="ImageHandler.next_annotation"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.next_annotation">[docs]</a>    <span class="k">def</span> <span class="nf">next_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method used by the annotator_panel which is initialised by self.trigger_annotation_mode to start the</span>
<span class="sd">        annotation exercise.</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>



        <span class="n">profiler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">profiler_dicts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">profile_dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_options</span><span class="o">.</span><span class="n">poly_loc_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_options</span><span class="o">.</span><span class="n">poly_loc_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_loc</span><span class="p">,</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span><span class="n">profiler</span><span class="o">.</span><span class="n">organ_name</span><span class="p">)</span>
        <span class="n">output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span><span class="n">date</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">profiler</span><span class="o">.</span><span class="n">current_index</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">profiler</span><span class="o">.</span><span class="n">label_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">profiler</span><span class="o">.</span><span class="n">current_index</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">rect_annotate_item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">qm</span> <span class="o">=</span> <span class="n">QMessageBox</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">qm</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s2">&quot;No annotations draw, please draw an annotation&quot;</span><span class="p">,</span>
                                      <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">qm</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="n">bounding_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">bounding_points</span>

                    <span class="n">profiler</span><span class="o">.</span><span class="n">annot_dict</span><span class="p">[</span><span class="n">profiler</span><span class="o">.</span><span class="n">label_names</span><span class="p">[</span><span class="n">profiler</span><span class="o">.</span><span class="n">current_index</span><span class="p">]]</span> <span class="o">=</span> \
                        <span class="n">bounding_points</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">joint_dropdown</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
                    <span class="n">label_name</span> <span class="o">=</span> <span class="n">profiler</span><span class="o">.</span><span class="n">label_names</span><span class="p">[</span><span class="n">profiler</span><span class="o">.</span><span class="n">current_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># print(label_name)</span>
                    <span class="n">organ_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">joint_dropdown</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

                    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span><span class="n">label_name</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
                    <span class="c1"># print(path)</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">bounding_points</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">clear_poly</span><span class="p">()</span>
            <span class="n">profiler</span><span class="p">()</span>
            <span class="n">label_name</span> <span class="o">=</span> <span class="n">profiler</span><span class="o">.</span><span class="n">label_names</span><span class="p">[</span><span class="n">profiler</span><span class="o">.</span><span class="n">current_index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1">#print(label_name)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">joint_dropdown</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">label_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">joint_name_qline</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">label_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">profiler_dicts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">profile_dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()]</span> <span class="o">=</span> <span class="n">profiler</span>

            <span class="c1"># self.image_scene.add_rectItemBase(1000,1000,220,220)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qm</span> <span class="o">=</span> <span class="n">QMessageBox</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">qm</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s2">&quot;Finished Annotating this image. Save all annotations?&quot;</span> <span class="p">,</span>
                              <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">qm</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="c1">#print(&quot;saving shit &quot;)</span>
                <span class="n">profiler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">profiler_dicts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_annotator_panel</span><span class="o">.</span><span class="n">profile_dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()]</span>
                <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_options</span><span class="o">.</span><span class="n">poly_loc_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_options</span><span class="o">.</span><span class="n">poly_loc_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

                <span class="n">output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_loc</span><span class="p">,</span><span class="nb">id</span><span class="p">)</span>
                <span class="n">output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span><span class="n">profiler</span><span class="o">.</span><span class="n">organ_name</span><span class="p">)</span>
                <span class="n">output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span><span class="n">date</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">profiler</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>



            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exiting now &quot;</span><span class="p">)</span></div>
        <span class="c1"># self.profiler_dicts[self.profile_dropdown.currentText()].label_names()</span>

<div class="viewcode-block" id="ImageHandler.prev_annotation"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.prev_annotation">[docs]</a>    <span class="k">def</span> <span class="nf">prev_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="ImageHandler.overwrite_annotation_poly"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.overwrite_annotation_poly">[docs]</a>    <span class="k">def</span> <span class="nf">overwrite_annotation_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves the polyline visible in self.image_scene under the file_path given by</span>
<span class="sd">        os.path.join(self.poly_select_options.loc_line_edit,self.poly_select_options.dropdown+&#39;txt&#39;). Connected to</span>
<span class="sd">        self.poly_select_options.overwrite_button</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">annotation_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_select_options</span><span class="o">.</span><span class="n">dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">annotation_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_select_options</span><span class="o">.</span><span class="n">loc_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">annotation_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_name</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">)</span>


        <span class="n">qm</span> <span class="o">=</span> <span class="n">QMessageBox</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">polyline_annotate_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">qm</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;Are you sure you want to overwrite &quot;</span><span class="o">+</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">qm</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">):</span>
                <span class="k">if</span>  <span class="n">ret</span> <span class="o">==</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>



                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">polyline_annotate_item</span><span class="o">.</span><span class="n">control_points</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">check_overwritten</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">)</span>
                    <span class="c1">#os.remove(annotation_path)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;keeping &quot;</span> <span class="o">+</span> <span class="n">annotation_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;file not present&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ImageHandler.overwrite_annotation_rect"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.overwrite_annotation_rect">[docs]</a>    <span class="k">def</span> <span class="nf">overwrite_annotation_rect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves the rectItem visible in self.image_scene under the file_path given by</span>
<span class="sd">        os.path.join(self.rect_select_options.loc_line_edit,self.rect_select_options.dropdown+&#39;txt&#39;). Connected to</span>
<span class="sd">        self.rect_select_options.overwrite_button</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">annotation_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect_select_options</span><span class="o">.</span><span class="n">dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">annotation_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect_select_options</span><span class="o">.</span><span class="n">loc_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">annotation_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_name</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">)</span>


        <span class="n">qm</span> <span class="o">=</span> <span class="n">QMessageBox</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">rect_annotate_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">qm</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;Are you sure you want to overwrite &quot;</span><span class="o">+</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">qm</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">):</span>
                <span class="k">if</span>  <span class="n">ret</span> <span class="o">==</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>


                    <span class="n">bounding_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_scene</span><span class="o">.</span><span class="n">rect_annotate_item</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">bounding_points</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">bounding_points</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">check_overwritten</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">)</span>
                    <span class="c1">#os.remove(annotation_path)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;keeping &quot;</span> <span class="o">+</span> <span class="n">annotation_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;file not present&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ImageHandler.check_overwritten"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImageHandler.check_overwritten">[docs]</a>    <span class="k">def</span> <span class="nf">check_overwritten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filepath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a dialog that tells the user if the file with path filepath has been recently modified. Due to the</span>
<span class="sd">        use case, and speed at which file saving is done, it does so by checking that the difference between the current</span>
<span class="sd">        time and the last time the file was modified is within 1s from each other</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Overwrote annotation under&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setDetailedText</span><span class="p">(</span><span class="s2">&quot;Save location </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">filepath</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>




<div class="viewcode-block" id="ImagingToolbar"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImagingToolbar">[docs]</a><span class="k">class</span> <span class="nc">ImagingToolbar</span><span class="p">(</span><span class="n">QToolBar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Toolbar with buttons showing the following actions:</span>
<span class="sd">    * &quot;Draw Polyline&quot;</span>
<span class="sd">    * &quot;Draw Rectangle&quot;</span>
<span class="sd">    * &quot;Zoom Out&quot;</span>
<span class="sd">    * &quot;Zoom In&quot;</span>
<span class="sd">    * &quot;Undo&quot;</span>
<span class="sd">    * &quot;Redo&quot;</span>
<span class="sd">    * &quot;Clear Label&quot;</span>

<span class="sd">    :param icon_lib:</span>
<span class="sd">    :type icon_lib:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">icon_lib</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ImagingToolbar</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># self.setStyleSheet(&quot;background-color: rgb(22,204,177);&quot;)</span>
        <span class="c1"># action_icon_names   = [os.path.join(&quot;icons&quot;,f) for f in [&quot;draw_poly.png&quot;,&quot;draw_rect.png&quot;,&quot;zoom_out.png&quot;,</span>
        <span class="c1">#                                                     &quot;zoom_in.png&quot;,</span>
        <span class="c1">#                                          &quot;undo.png&quot;,</span>
        <span class="c1">#                               &quot;redo.png&quot;,</span>
        <span class="c1">#                        &quot;clear-icon-3.png&quot;]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icons</span> <span class="o">=</span> <span class="n">icon_lib</span>
        <span class="n">action_descriptions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Draw Polyline&quot;</span><span class="p">,</span><span class="s2">&quot;Draw Rectangle&quot;</span><span class="p">,</span><span class="s2">&quot;Zoom Out&quot;</span><span class="p">,</span><span class="s2">&quot;Zoom In&quot;</span><span class="p">,</span><span class="s2">&quot;Undo&quot;</span><span class="p">,</span><span class="s2">&quot;Redo&quot;</span><span class="p">,</span><span class="s2">&quot;Clear Label&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_buttons</span><span class="p">()</span>


<div class="viewcode-block" id="ImagingToolbar.load_buttons"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.ImagingToolbar.load_buttons">[docs]</a>    <span class="k">def</span> <span class="nf">load_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># assert len(action_icon_names)==len(descriptions)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Create toolbar widgets, connect to actions and add to toolbar#set</span>
        <span class="k">for</span> <span class="n">keys</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">icons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">action_button</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">keys</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action_button</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="o">=</span> <span class="n">action_button</span></div></div>


<div class="viewcode-block" id="AnnotationSelectOptions"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.AnnotationSelectOptions">[docs]</a><span class="k">class</span> <span class="nc">AnnotationSelectOptions</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generic Qwidget that displayes the location and name of the annotations that were saved so far.</span>


<span class="sd">    :param name: name of the type of annotation being displayed. Text Will appear inside a QLabel next to self.dropdown</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :param profile: currently unused</span>
<span class="sd">    :type profile: None</span>

<span class="sd">    :ivar layout: Layout of the QWidget</span>
<span class="sd">    :vartype layout: QVBoxLayout</span>
<span class="sd">    :ivar dropdown: dropdown list containing the list of annotations saved so far</span>
<span class="sd">    :vartype dropdown: QComboBox</span>
<span class="sd">    :ivar overwrite_button: Button that can be linked to an overwrite method. The overwrite method needs to save the</span>
<span class="sd">                            data structure viewable in the parent widget of AnnotationSelectOptions under the name appearing in the</span>
<span class="sd">                            AnnotationSelectOptions.dropdown in the location appearing in the AnnotationSelectOptions.loc_line_edit</span>
<span class="sd">    :vartype overwrite_button: QPushButton</span>
<span class="sd">    :ivar delete_button: Button that is linked to the delete_annotation method. Clicking the button will delete the .txt</span>
<span class="sd">                         file whose name is the current_text of AnnotationSelectOptions.dropdown and is located in</span>
<span class="sd">                         AnnotationSelectOptions.dropdown.text()</span>
<span class="sd">    :vartype delete_button: QPushButton</span>
<span class="sd">    :ivar loc_line_edit: Provides a text area that Displays the folder where annotations have been saved. The text needs</span>
<span class="sd">                         to be set by the parent widget when building the full UI</span>
<span class="sd">    :vartype loc_line_edit: QLineEdit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Polyline&#39;</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot;Initialises the class</span>



<span class="sd">        &quot;&quot;&quot;</span>




        <span class="nb">super</span><span class="p">(</span><span class="n">AnnotationSelectOptions</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<div class="viewcode-block" id="AnnotationSelectOptions.init"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.AnnotationSelectOptions.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">layout1</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setMaximumSize</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropdown</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropdown</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">box_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Display &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">box_label</span><span class="o">.</span><span class="n">setMaximumSize</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">box_label</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_box</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">()</span>
        <span class="n">layout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">layout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropdown</span><span class="p">)</span>
        <span class="n">layout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box_label</span><span class="p">)</span>
        <span class="n">layout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_box</span><span class="p">)</span>
        <span class="n">hspacer</span> <span class="o">=</span> <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span>
                              <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">)</span>
        <span class="n">layout1</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">hspacer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">overwrite_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Overwrite&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Delete&quot;</span><span class="p">)</span>

        <span class="n">layout2</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">layout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overwrite_button</span><span class="p">)</span>
        <span class="n">layout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_button</span><span class="p">)</span>
        <span class="n">hspacer</span> <span class="o">=</span> <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span>
                              <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">)</span>
        <span class="n">layout2</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">hspacer</span><span class="p">)</span>
        <span class="n">widget1</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">widget1</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout1</span><span class="p">)</span>
        <span class="n">widget2</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">widget2</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_line_edit</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_line_edit</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_line_edit</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_line_edit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget2</span><span class="p">)</span>
        <span class="n">vspacer</span> <span class="o">=</span> <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span>
                              <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">vspacer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_annotation</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotationSelectOptions.delete_annotation"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.AnnotationSelectOptions.delete_annotation">[docs]</a>    <span class="k">def</span> <span class="nf">delete_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes the file whose full path is equal to os.path.join(annotation_path, annotation_name+&#39;.txt&#39;) where</span>
<span class="sd">         annotation path is the text appearing in self.loc_line_edit and annotation name is the name of the annotation</span>
<span class="sd">         appeaing in self.dropdown</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: NOne</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">annotation_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">annotation_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">annotation_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_name</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">)</span>

        <span class="n">qm</span> <span class="o">=</span> <span class="n">QMessageBox</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">qm</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;Are you sure you want to delete &quot;</span><span class="o">+</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">qm</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">):</span>
            <span class="k">if</span>  <span class="n">ret</span> <span class="o">==</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;deleting &quot;</span> <span class="o">+</span><span class="n">annotation_path</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">dropdown</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropdown</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;keeping &quot;</span> <span class="o">+</span> <span class="n">annotation_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;file not present&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AnnotationModelOptions"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.AnnotationModelOptions">[docs]</a><span class="k">class</span> <span class="nc">AnnotationModelOptions</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Widget that allows the user to select options for the size of the Graphics items points and lines through the</span>
<span class="sd">    use of sliders. Initialising the class only initialises the sliders.</span>

<span class="sd">    :param name:</span>
<span class="sd">    :type name:</span>
<span class="sd">    :param profile:</span>
<span class="sd">    :type profile:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Score&#39;</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="p">{}):</span>




        <span class="nb">super</span><span class="p">(</span><span class="n">AnnotationModelOptions</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<div class="viewcode-block" id="AnnotationModelOptions.init"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.AnnotationModelOptions.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_score_slider</span><span class="p">()</span> <span class="c1">#initialises the score sliders for dsicrete scales</span>
        <span class="c1"># self.init_select_polylines()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span></div>
        <span class="c1"># self.delete_poly_button.clicked.connect(self.delete_selected_poly)</span>
        <span class="c1"># self.delete_rect_button.clicked.connect(self.delete_selected_rect)</span>


<div class="viewcode-block" id="AnnotationModelOptions.init_score_slider"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.AnnotationModelOptions.init_score_slider">[docs]</a>    <span class="k">def</span> <span class="nf">init_score_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mthod to initialise 2 sliders, one for the line width and the other for the point size.</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_slider_layout</span> <span class="o">=</span> <span class="n">score_sliders</span><span class="p">(</span><span class="n">score_name</span><span class="o">=</span><span class="s2">&quot;Annotation Model&quot;</span><span class="p">,</span><span class="n">damage_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Dot Size&quot;</span><span class="p">,</span><span class="s2">&quot;Line Width&quot;</span><span class="p">],</span>
                                            <span class="n">damage_ranges</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;These are the sliders for width&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score_slider_layout</span><span class="o">.</span><span class="n">sliders</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score_slider_layout</span><span class="p">)</span>
        <span class="n">vspacer</span> <span class="o">=</span> <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span>
                              <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">vspacer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_sliders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_slider_layout</span><span class="o">.</span><span class="n">sliders</span>
        <span class="c1"># self.score_sliders[&#39;Line Width&#39;].setValue(DEFAULT_EDGE_WIDTH)</span>

        <span class="c1"># self.score_sliders[&#39;Line Width&#39;].setMinimumWidth(300)</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_sliders</span><span class="p">[</span><span class="s1">&#39;Dot Size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">DEFAULT_HANDLE_SIZE</span><span class="p">)</span>
        <span class="n">hspacer</span> <span class="o">=</span> <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span>
                              <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">hspacer</span><span class="p">)</span></div>


        <span class="c1"># for key,val in self.score_sliders.items():</span>
        <span class="c1">#     #val.sliderMoved[int].connect(self.save_slider_value())</span>
        <span class="c1">#     val.valueChanged[int].connect(self.get_slider_value)</span>

<div class="viewcode-block" id="AnnotationModelOptions.init_select_polylines"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.AnnotationModelOptions.init_select_polylines">[docs]</a>    <span class="k">def</span> <span class="nf">init_select_polylines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">layout1</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">polyline_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Polylines&quot;</span><span class="p">)</span>
        <span class="n">polyline_label</span><span class="o">.</span><span class="n">setMaximumSize</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">polyline_label</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polyline_dropdown</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="n">polyline_box_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Display Polys&quot;</span><span class="p">)</span>
        <span class="n">polyline_box_label</span><span class="o">.</span><span class="n">setMaximumSize</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">polyline_box_label</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_polylines_box</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">()</span>
        <span class="n">layout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">polyline_label</span><span class="p">)</span>
        <span class="n">layout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polyline_dropdown</span><span class="p">)</span>
        <span class="n">layout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">polyline_box_label</span><span class="p">)</span>
        <span class="n">layout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_polylines_box</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">overwrite_poly_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Overwrite&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_poly_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Delete&quot;</span><span class="p">)</span>

        <span class="n">layout2</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">layout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overwrite_poly_button</span><span class="p">)</span>
        <span class="n">layout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_poly_button</span><span class="p">)</span>
        <span class="c1"># layout1.addWidget(self.overwrite_poly_button)</span>

        <span class="n">layout3</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">rectItem_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Rect-Items&quot;</span><span class="p">)</span>
        <span class="n">rectItem_label</span><span class="o">.</span><span class="n">setMaximumSize</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">rectItem_label</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rectItem_dropdown</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="n">rectItem_box_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Display Rectangles&quot;</span><span class="p">)</span>
        <span class="n">rectItem_box_label</span><span class="o">.</span><span class="n">setMaximumSize</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">rectItem_box_label</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_rectItem_box</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">()</span>
        <span class="n">layout3</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">rectItem_label</span><span class="p">)</span>
        <span class="n">layout3</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rectItem_dropdown</span><span class="p">)</span>
        <span class="n">layout3</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">rectItem_box_label</span><span class="p">)</span>
        <span class="n">layout3</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_rectItem_box</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">overwrite_rect_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Overwrite&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_rect_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Delete&quot;</span><span class="p">)</span>
        <span class="n">layout4</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">layout4</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overwrite_rect_button</span><span class="p">)</span>
        <span class="n">layout4</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_rect_button</span><span class="p">)</span>

        <span class="n">widget1</span> <span class="o">=</span>  <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">layout1</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">widget1</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout1</span><span class="p">)</span>

        <span class="n">widget2</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">widget2</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout2</span><span class="p">)</span>

        <span class="n">widget3</span> <span class="o">=</span>  <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">widget3</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout3</span><span class="p">)</span>

        <span class="n">widget4</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">widget4</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout4</span><span class="p">)</span>

        <span class="n">layout_poly</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_loc_line_edit</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_loc_line_edit</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">layout_poly</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poly_loc_line_edit</span><span class="p">)</span>
        <span class="n">layout_poly</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget1</span><span class="p">)</span>
        <span class="n">layout_poly</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget2</span><span class="p">)</span>
        <span class="n">widget_poly</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">widget_poly</span><span class="o">.</span><span class="n">setFrameStyle</span><span class="p">(</span><span class="n">QFrame</span><span class="o">.</span><span class="n">Box</span><span class="p">)</span>
        <span class="n">widget_poly</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">widget_poly</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout_poly</span><span class="p">)</span>


        <span class="n">layout_rect</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect_loc_line_edit</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect_loc_line_edit</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">layout_rect</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget3</span><span class="p">)</span>
        <span class="n">layout_rect</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget4</span><span class="p">)</span>
        <span class="n">widget_rect</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">widget_rect</span><span class="o">.</span><span class="n">setFrameStyle</span><span class="p">(</span><span class="n">QFrame</span><span class="o">.</span><span class="n">Box</span><span class="p">)</span>
        <span class="n">widget_rect</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">widget_rect</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout_rect</span><span class="p">)</span>

        <span class="c1"># widget_poly.setStyleSheet(&quot;border: 1px solid black; margin: 0px; padding: 0px;&quot;)</span>





        <span class="n">tabs</span> <span class="o">=</span> <span class="n">QTabWidget</span><span class="p">()</span>
        <span class="c1"># tabs.setMinimumWidth(1000)</span>
        <span class="c1"># tabs.setMaximumWidth(1000)</span>
        <span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">widget_poly</span><span class="p">,</span><span class="s1">&#39;Polylines&#39;</span><span class="p">)</span>
        <span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">widget_rect</span><span class="p">,</span><span class="s1">&#39;Rectangle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">tabs</span><span class="p">)</span>
        <span class="c1"># self.selection_layout.addWidget(widget1)</span>
        <span class="c1"># self.selection_layout.addWidget(widget2)</span>
        <span class="c1"># self.selection_layout.addWidget(widget_poly)</span>
        <span class="c1"># self.selection_layout.addWidget(widget3)</span>
        <span class="c1"># self.selection_layout.addWidget(widget4)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_layout</span><span class="p">)</span></div>



<div class="viewcode-block" id="AnnotationModelOptions.delete_selected_poly"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.AnnotationModelOptions.delete_selected_poly">[docs]</a>    <span class="k">def</span> <span class="nf">delete_selected_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">annotation_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polyline_dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="c1"># print(annotation_name)</span>
        <span class="n">annotation_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_loc_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">annotation_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_name</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
        <span class="c1"># popupWindow = QMessageBox.question(self, &#39;Warning!&#39;,</span>
        <span class="c1">#                                         &quot;Are you sure you want to delete &quot;+annotation_name+&quot;?&quot;,QMessageBox.No,</span>
        <span class="c1">#                                         QMessageBox.Ok)</span>
        <span class="n">qm</span> <span class="o">=</span> <span class="n">QMessageBox</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">qm</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;Are you sure you want to delete &quot;</span><span class="o">+</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">qm</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">):</span>
            <span class="k">if</span>  <span class="n">ret</span> <span class="o">==</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;deleting &quot;</span> <span class="o">+</span><span class="n">annotation_path</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">polyline_dropdown</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polyline_dropdown</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;keeping &quot;</span> <span class="o">+</span> <span class="n">annotation_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;file not present&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="AnnotationModelOptions.delete_selected_rect"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.AnnotationModelOptions.delete_selected_rect">[docs]</a>    <span class="k">def</span> <span class="nf">delete_selected_rect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">annotation_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rectItem_dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="c1"># print(annotation_name)</span>
        <span class="n">annotation_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect_loc_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">annotation_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_name</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
        <span class="c1"># popupWindow = QMessageBox.question(self, &#39;Warning!&#39;,</span>
        <span class="c1">#                                         &quot;Are you sure you want to delete &quot;+annotation_name+&quot;?&quot;,QMessageBox.No,</span>
        <span class="c1">#                                         QMessageBox.Ok)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">):</span>
            <span class="n">qm</span> <span class="o">=</span> <span class="n">QMessageBox</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">qm</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;Are you sure you want to delete &quot;</span><span class="o">+</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">qm</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
            <span class="k">if</span>  <span class="n">ret</span> <span class="o">==</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;deleting &quot;</span> <span class="o">+</span><span class="n">annotation_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rectItem_dropdown</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rectItem_dropdown</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;keeping &quot;</span> <span class="o">+</span> <span class="n">annotation_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;file not present&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotationModelOptions.get_slider_value"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.AnnotationModelOptions.get_slider_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_slider_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">my_dict</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_slider_layout</span><span class="o">.</span><span class="n">get_slider_values</span><span class="p">()</span>


        <span class="k">return</span> <span class="n">my_dict</span></div></div>

<div class="viewcode-block" id="MatfileOptions"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MatfileOptions">[docs]</a><span class="k">class</span> <span class="nc">MatfileOptions</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MatfileOptions</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialise_layout</span><span class="p">()</span>

<div class="viewcode-block" id="MatfileOptions.initialise_layout"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MatfileOptions.initialise_layout">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Select key&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combo</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="c1"># self.combo.addItems([&quot;option1&quot;, &quot;option2&quot;, &quot;option3&quot;])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="n">QDialogButtonBox</span><span class="p">(</span>
            <span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">,</span>
            <span class="n">centerButtons</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>

        <span class="n">lay</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">lay</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">lay</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">lay</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">240</span><span class="p">)</span></div>

<div class="viewcode-block" id="MatfileOptions.load_keys"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.MatfileOptions.load_keys">[docs]</a>    <span class="k">def</span> <span class="nf">load_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">matfile</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">keys</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">matfile</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">combo</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span></div></div>

















































<div class="viewcode-block" id="JointAnnotatorPanel"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.JointAnnotatorPanel">[docs]</a><span class="k">class</span> <span class="nc">JointAnnotatorPanel</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Score&#39;</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="p">{}):</span>



        <span class="nb">super</span><span class="p">(</span><span class="n">JointAnnotatorPanel</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># self.layout = QHBoxLayout()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_loc</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>

<div class="viewcode-block" id="JointAnnotatorPanel.init"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.JointAnnotatorPanel.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_annotator_panel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span></div>
        <span class="c1"># self.connect_buttons()</span>
        <span class="c1"># self.delete_poly_button.clicked.connect(self.delete_selected_poly)</span>
        <span class="c1"># self.delete_rect_button.clicked.connect(self.delete_selected_rect)</span>

<div class="viewcode-block" id="JointAnnotatorPanel.init_annotator_panel"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.JointAnnotatorPanel.init_annotator_panel">[docs]</a>    <span class="k">def</span> <span class="nf">init_annotator_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">profile_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Annotation Profile&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_dropdown</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_button</span>     <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Reset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
        <span class="n">joint_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Current Joint&quot;</span><span class="p">)</span>
        <span class="c1"># joint_label.setMaximumSize(100, 30)</span>
        <span class="c1"># joint_label.setMinimumSize(100, 30)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_name_qline</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_name_qline</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Prev&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_button</span>     <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Next&#39;</span><span class="p">)</span>

        <span class="n">joint_list_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Previous Joints&quot;</span><span class="p">)</span>
        <span class="n">joint_label</span><span class="o">.</span><span class="n">setMaximumSize</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">joint_label</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_dropdown</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">profile_label</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_dropdown</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_button</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_button</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">joint_label</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_name_qline</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_button</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_button</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">joint_list_label</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_dropdown</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span></div>




<div class="viewcode-block" id="JointAnnotatorPanel.delete_selected_poly"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.JointAnnotatorPanel.delete_selected_poly">[docs]</a>    <span class="k">def</span> <span class="nf">delete_selected_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">annotation_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polyline_dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="c1"># print(annotation_name)</span>
        <span class="n">annotation_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_loc_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">annotation_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_name</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
        <span class="c1"># popupWindow = QMessageBox.question(self, &#39;Warning!&#39;,</span>
        <span class="c1">#                                         &quot;Are you sure you want to delete &quot;+annotation_name+&quot;?&quot;,QMessageBox.No,</span>
        <span class="c1">#                                         QMessageBox.Ok)</span>
        <span class="n">qm</span> <span class="o">=</span> <span class="n">QMessageBox</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">qm</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;Are you sure you want to delete &quot;</span><span class="o">+</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">qm</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">):</span>
            <span class="k">if</span>  <span class="n">ret</span> <span class="o">==</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;deleting &quot;</span> <span class="o">+</span><span class="n">annotation_path</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">polyline_dropdown</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polyline_dropdown</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;keeping &quot;</span> <span class="o">+</span> <span class="n">annotation_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;file not present&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="JointAnnotatorPanel.delete_selected_rect"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.JointAnnotatorPanel.delete_selected_rect">[docs]</a>    <span class="k">def</span> <span class="nf">delete_selected_rect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">annotation_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rectItem_dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="c1"># print(annotation_name)</span>
        <span class="n">annotation_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect_loc_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">annotation_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_name</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
        <span class="c1"># popupWindow = QMessageBox.question(self, &#39;Warning!&#39;,</span>
        <span class="c1">#                                         &quot;Are you sure you want to delete &quot;+annotation_name+&quot;?&quot;,QMessageBox.No,</span>
        <span class="c1">#                                         QMessageBox.Ok)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">):</span>
            <span class="n">qm</span> <span class="o">=</span> <span class="n">QMessageBox</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">qm</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;Are you sure you want to delete &quot;</span><span class="o">+</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">qm</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
            <span class="k">if</span>  <span class="n">ret</span> <span class="o">==</span> <span class="n">qm</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;deleting &quot;</span> <span class="o">+</span><span class="n">annotation_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rectItem_dropdown</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rectItem_dropdown</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;keeping &quot;</span> <span class="o">+</span> <span class="n">annotation_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;file not present&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="JointAnnotatorPanel.get_slider_value"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.JointAnnotatorPanel.get_slider_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_slider_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">my_dict</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_slider_layout</span><span class="o">.</span><span class="n">get_slider_values</span><span class="p">()</span>


        <span class="k">return</span> <span class="n">my_dict</span></div>

<div class="viewcode-block" id="JointAnnotatorPanel.load_profilers"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.JointAnnotatorPanel.load_profilers">[docs]</a>    <span class="k">def</span> <span class="nf">load_profilers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler_dicts</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profiler_dicts</span><span class="p">[</span><span class="s1">&#39;Hand-Finger-Joint-Profiler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HandJointAnnotationProfiler</span><span class="p">(</span><span class="n">output_loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_loc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_dropdown</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;Hand-Finger-Joint-Profiler&#39;</span><span class="p">)</span></div></div>




<div class="viewcode-block" id="Window_Sliders"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.Window_Sliders">[docs]</a><span class="k">class</span> <span class="nc">Window_Sliders</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pixel_array</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Window_Sliders</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialise</span><span class="p">(</span><span class="n">pixel_array</span><span class="p">)</span>

<div class="viewcode-block" id="Window_Sliders.initialise"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.Window_Sliders.initialise">[docs]</a>    <span class="k">def</span> <span class="nf">initialise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pixel_array</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pixel_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_pix</span> <span class="o">=</span> <span class="mi">500</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_pix</span> <span class="o">=</span> <span class="mi">6000</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">min_pix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pixel_array</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_pix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pixel_array</span><span class="p">)</span>
        <span class="n">min_pix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_pix</span>
        <span class="n">max_pix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pix</span>
        <span class="n">tick_interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_pix</span><span class="o">-</span><span class="n">min_pix</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">slider_initial_pos</span> <span class="o">=</span> <span class="mi">50</span><span class="o">*</span><span class="n">tick_interval</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
        <span class="n">level_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Level&#39;</span><span class="p">)</span>
        <span class="n">window_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Window&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">level_slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level_slider</span><span class="o">.</span><span class="n">setOrientation</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level_slider</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">min_pix</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_pix</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level_slider</span><span class="o">.</span><span class="n">setTickInterval</span><span class="p">(</span><span class="n">tick_interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level_slider</span><span class="o">.</span><span class="n">setSliderPosition</span><span class="p">(</span><span class="n">slider_initial_pos</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">window_slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_slider</span><span class="o">.</span><span class="n">setOrientation</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>

        <span class="n">tick_interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_pix</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_slider</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_pix</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level_slider</span><span class="o">.</span><span class="n">setTickInterval</span><span class="p">(</span><span class="n">tick_interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_slider</span><span class="o">.</span><span class="n">setSliderPosition</span><span class="p">(</span><span class="n">tick_interval</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invert_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Invert Image&#39;</span><span class="p">)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">level_label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level_slider</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">window_label</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_slider</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invert_button</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">vspacer</span> <span class="o">=</span> <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span>
                              <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">vspacer</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">hspacer</span> <span class="o">=</span> <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span>
                              <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">hspacer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># self.level_slider.valueChanged.connect(self.change_window_slider_vals)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span></div>


<div class="viewcode-block" id="Window_Sliders.get_window_levels"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.Window_Sliders.get_window_levels">[docs]</a>    <span class="k">def</span> <span class="nf">get_window_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_slider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">level</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_slider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">window</span><span class="p">,</span><span class="n">level</span></div></div>

<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># class score_sliders(QVBoxLayout):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     For discrete scores</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     def __init__(self,score_name=&#39;Ratingen&#39;,damage_types=[&#39;Destruction&#39;,&#39;Proliferation&#39;],damage_ranges=[(0,5),(0,5)],</span>
<span class="c1">#                  opt_kwargs={}):</span>
<span class="c1">#         super(score_sliders,self).__init__()</span>
<span class="c1">#         self.opt_kwargs = opt_kwargs</span>
<span class="c1">#         self.font_header = QFont(&#39;Android Roboto&#39;, 15)</span>
<span class="c1">#         self.font_subheader = QFont(&#39;Android Roboto&#39;, 13)</span>
<span class="c1">#         self.font_text = QFont(&#39;Android Roboto&#39;, 10)</span>
<span class="c1">#         self.font_button = QFont(&#39;Android Roboto&#39;, 11)</span>
<span class="c1">#         self.score_name    = score_name</span>
<span class="c1">#         self.damage_types  = damage_types</span>
<span class="c1">#         self.damage_ranges = damage_ranges</span>
<span class="c1">#         self.sliders       = {}</span>
<span class="c1">#         self.init_sliders()</span>
<span class="c1">#</span>
<span class="c1">#     def init_sliders(self):</span>
<span class="c1">#         min_label_width = self.opt_kwargs.pop(&#39;label_minimum_width&#39;,110)</span>
<span class="c1">#         tick_spacing    = self.opt_kwargs.pop(&#39;tick_spacing&#39;,30)</span>
<span class="c1">#         slider_gap      = self.opt_kwargs.pop(&#39;slider_gap&#39;,130)</span>
<span class="c1">#         for damage,rng in zip(self.damage_types,self.damage_ranges):</span>
<span class="c1">#             layout = QHBoxLayout()</span>
<span class="c1">#             # print(damage)</span>
<span class="c1">#             label  = QLabel(damage)</span>
<span class="c1">#             label.setFont(self.font_text)</span>
<span class="c1">#             label.setMinimumWidth(min_label_width)</span>
<span class="c1">#             layout.addWidget(label)</span>
<span class="c1">#</span>
<span class="c1">#             slider_layout = QGridLayout()</span>
<span class="c1">#             score_slider   = Slider()</span>
<span class="c1">#             score_slider.setPageStep(0)</span>
<span class="c1">#             score_slider.setStyleSheet(&quot;QSlider::handle:horizontal {background-color: #16CCB1;}&quot;)</span>
<span class="c1">#             score_slider.setOrientation(Qt.Horizontal)</span>
<span class="c1">#             score_slider.setRange(rng[0],rng[1])</span>
<span class="c1">#             score_slider.setTickInterval(1)</span>
<span class="c1">#             score_slider.setSingleStep(1)</span>
<span class="c1">#             slider_layout.setHorizontalSpacing(score_slider.tickInterval())</span>
<span class="c1">#             score_slider.setTickPosition(QSlider.TicksBelow)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#             slider_label_layout  = QHBoxLayout()</span>
<span class="c1">#             scores = np.arange(rng[0],rng[1]+1)</span>
<span class="c1">#</span>
<span class="c1">#             for score in scores:</span>
<span class="c1">#                 slider_layout.addWidget(QLabel(str(score)),0,int(score),Qt.AlignHCenter)</span>
<span class="c1">#             score_slider.setMinimumWidth(450)</span>
<span class="c1">#             slider_layout.addWidget(score_slider,1,0,1,rng[1]-rng[0]+1,Qt.AlignBottom)</span>
<span class="c1">#</span>
<span class="c1">#             # slider_layout.addLayout(slider_label_layout)</span>
<span class="c1">#</span>
<span class="c1">#             hspacer = QSpacerItem(30,30,</span>
<span class="c1">#                                   QSizePolicy.Expanding,QSizePolicy.Expanding)</span>
<span class="c1">#             layout.addLayout(slider_layout)</span>
<span class="c1">#             layout.addItem(hspacer)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#             self.sliders[damage] = score_slider</span>
<span class="c1">#             self.addLayout(layout)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#     def reinit_values(self):</span>
<span class="c1">#         for keys,val in self.sliders.items():</span>
<span class="c1">#             val.setValue(0)</span>
<span class="c1">#</span>
<span class="c1">#     def print_slider_values(self):</span>
<span class="c1">#         for keys,val in self.sliders.items():</span>
<span class="c1">#             print(val.value())</span>
<span class="c1">#</span>
<span class="c1">#     def get_slider_values(self):</span>
<span class="c1">#         mydict = {}</span>
<span class="c1">#         for keys, val in self.sliders.items():</span>
<span class="c1">#             mydict[keys]=val.value()</span>
<span class="c1">#         print(mydict)</span>
<span class="c1">#         return mydict</span>

<div class="viewcode-block" id="main"><a class="viewcode-back" href="../imaging_widgets.html#imaging_widgets.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">([])</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">QMainWindow</span><span class="p">()</span>

    <span class="n">my_frame_widget</span> <span class="o">=</span> <span class="n">JointAnnotatorPanel</span><span class="p">()</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">my_frame_widget</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="n">my_frame_widget</span><span class="p">)</span>
    <span class="c1"># layout.addWidget(QPushButton(&#39;3&#39;))</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>


<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Adwaye Rambojun.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>